"use strict";

module.exports = function readFiles(files, fileReaderMethodName, callback) {
  var length = files.length;
  var arrayOfFiles = Array(length);
  var j = 0;

  function createLoadendHandler(_ref) {
    var file = _ref.file,
        reader = _ref.reader;
    return function loadendHandler() {
      file.readerResult = reader.result; // eslint-disable-line no-param-reassign

      j += 1;

      if (j === length) {
        callback(arrayOfFiles);
      }

      reader.removeEventListener('loadend', loadendHandler);
    };
  }

  if (fileReaderMethodName) {
    for (var i = 0; i < length; i += 1) {
      var reader = new window.FileReader();
      var file = files[i];
      arrayOfFiles[i] = file;
      reader.addEventListener('loadend', createLoadendHandler({
        file: file,
        reader: reader
      }));
      reader[fileReaderMethodName](file);
    }
  } else {
    for (var _i = 0; _i < length; _i += 1) {
      arrayOfFiles[_i] = files[_i];
    }

    callback(arrayOfFiles);
  }
};