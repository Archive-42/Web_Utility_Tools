{"version":3,"sources":["../../../src/array/recreate/index.js"],"names":["recreate","givenNewItems","eventOptions","def","itemMediator","newLength","length","oldLength","lengthDiff","was","toJSON","trackBy","skipItemMediator","silent","dontRender","added","removed","newItems","arr","toMediate","Array","i","indexOf","push","method","self"],"mappings":"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","sourcesContent":["import initSeemple from '../../_core/init';\nimport reportModified from '../_reportmodified';\nimport updateTracked from './_updatetracked';\n\n// recreates an array\nexport default function recreate(givenNewItems = [], eventOptions = {}) {\n  const def = initSeemple(this);\n  const { itemMediator } = def;\n  const newLength = givenNewItems.length;\n  const oldLength = this.length;\n  const lengthDiff = oldLength - newLength;\n  const was = this.toJSON(false);\n  const { trackBy } = this;\n  const { skipItemMediator, silent, dontRender } = eventOptions;\n  let added;\n  let removed;\n  let newItems;\n\n  if (trackBy) {\n    // if trackBy property is given then update givenNewItems array\n    newItems = updateTracked({\n      arr: this,\n      givenNewItems,\n      trackBy\n    });\n  } else {\n    // if trackBy is not given then use given new items as is\n    newItems = givenNewItems;\n  }\n\n  // call item mediator for every new item (but don't modify passed newItems)\n  if (itemMediator && !skipItemMediator) {\n    const toMediate = newItems;\n    newItems = Array(newLength);\n    for (let i = 0; i < newLength; i++) {\n      newItems[i] = itemMediator(toMediate[i], i);\n    }\n  }\n\n  // update array indexes with new values\n  for (let i = 0; i < newLength; i++) {\n    this[i] = newItems[i];\n  }\n\n  // remove old items that is out of new length\n  for (let i = 0; i < lengthDiff; i++) {\n    delete this[i + newLength];\n  }\n\n  // update length\n  this.length = newLength;\n\n  if (silent && dontRender) {\n    return this;\n  }\n\n  // create an array of removed items\n  // TODO: Optimize creation of \"added\" and \"removed\" options in recreate method\n  // ... (do not use indexOf)\n  if (newLength) {\n    if (oldLength) {\n      removed = [];\n      for (let i = 0; i < oldLength; i++) {\n        if (!~newItems.indexOf(was[i])) {\n          removed.push(was[i]);\n        }\n      }\n    } else {\n      removed = [];\n    }\n  } else {\n    removed = was;\n  }\n\n  // create an array of added items\n  if (oldLength) {\n    if (newLength) {\n      added = [];\n      for (let i = 0; i < newLength; i++) {\n        if (!~was.indexOf(newItems[i])) {\n          added.push(newItems[i]);\n        }\n      }\n    } else {\n      added = [];\n    }\n  } else {\n    added = newItems;\n  }\n\n  reportModified(this, {\n    added,\n    removed,\n    method: 'recreate',\n    self: this,\n    ...eventOptions\n  });\n\n  return this;\n}\n"],"file":"index.js"}