{"version":3,"sources":["../../src/calc/index.js"],"names":["calc","object","target","sources","givenHandler","eventOptions","isSeemple","Object","itemTarget","itemSource","source","itemHandler","handler","itemEventOptions","event","commonEventOptions","mergedEventOptions","def","setOnInit","debounceCalcOnInit","debounceCalc","debounceCalcDelay","isTargetPropertyHidden","defaultHandler","value","allSources","syncCalcHandler","debouncedCalcHandler","calcHandler","Array","sourceKey","sourceObject","key","sourceKeyItem"],"mappings":"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","sourcesContent":["import initSeemple from '../_core/init';\nimport checkObjectType from '../_helpers/checkobjecttype';\nimport seempleError from '../_helpers/seempleerror';\nimport assign from '../_helpers/assign';\nimport debounce from '../_helpers/debounce';\nimport forEach from '../_helpers/foreach';\nimport forOwn from '../_helpers/forown';\nimport addSource from './_addsource';\nimport createCalcHandler from './_createcalchandler';\nimport defineProp from '../_core/defineprop';\n\n// defines a property which is dependend on other properties\nexport default function calc(object, target, sources, givenHandler, eventOptions) {\n  if (typeof this === 'object' && this.isSeemple) {\n    // when context is Seemple instance, use this as an object and shift other args\n    /* eslint-disable no-param-reassign */\n    eventOptions = givenHandler;\n    givenHandler = sources;\n    sources = target;\n    target = object;\n    object = this;\n    /* eslint-enable no-param-reassign */\n  } else {\n    // throw error when object type is wrong\n    checkObjectType(object, 'calc');\n  }\n\n  if (target instanceof Object) {\n    /*\n         * accept an object\n         * this.calc({target: { source, handler, event } }, commonEventOptions);\n         */\n    forOwn(target, ({\n      source: itemSource,\n      handler: itemHandler,\n      event: itemEventOptions\n    }, itemTarget) => {\n      const commonEventOptions = sources;\n      const mergedEventOptions = {};\n\n      if (commonEventOptions) {\n        // extend event object by \"global\" event\n        assign(mergedEventOptions, commonEventOptions);\n      }\n\n      if (itemEventOptions) {\n        // extend event object by \"local\" event (\"event\" key of an object)\n        assign(mergedEventOptions, itemEventOptions);\n      }\n\n      calc(object, itemTarget, itemSource, itemHandler, mergedEventOptions);\n    });\n\n    return object;\n  }\n\n  if (typeof target !== 'string') {\n    throw seempleError('calc:target_type', { target });\n  }\n\n  eventOptions = eventOptions || {}; // eslint-disable-line no-param-reassign\n  const def = initSeemple(object);\n  const {\n    setOnInit = true,\n    debounceCalcOnInit = false,\n    debounceCalc = true,\n    debounceCalcDelay = 0,\n    // the next option is used to hide a property for internal use (eg in bindings parser)\n    // hidden property means no accessors\n    isTargetPropertyHidden = false\n  } = eventOptions;\n  const defaultHandler = (value) => value;\n  const handler = givenHandler || defaultHandler;\n  const allSources = [];\n  const syncCalcHandler = createCalcHandler({\n    object,\n    eventOptions,\n    allSources,\n    target,\n    def,\n    handler\n  });\n\n  let debouncedCalcHandler;\n  let calcHandler;\n\n  if (debounceCalcOnInit || debounceCalc) {\n    debouncedCalcHandler = debounce(syncCalcHandler, debounceCalcDelay);\n  }\n\n  defineProp(object, target, isTargetPropertyHidden);\n\n  if (!(sources instanceof Array)) {\n    sources = [sources]; // eslint-disable-line no-param-reassign\n  }\n\n  if (debounceCalc) {\n    calcHandler = debouncedCalcHandler;\n  } else {\n    calcHandler = syncCalcHandler;\n  }\n\n  forEach(sources, (source) => {\n    if (typeof source === 'string') {\n      // source object is current object\n      addSource({\n        calcHandler,\n        allSources,\n        sourceKey: source,\n        sourceObject: object,\n        eventOptions\n      });\n    } else {\n      // source object is external object\n      if (!source || typeof source !== 'object') {\n        throw seempleError('calc:source_type', { source });\n      }\n\n      const sourceKey = source.key;\n      const sourceObject = source.object;\n      if (sourceKey instanceof Array) {\n        // many keys are passed\n        forEach(sourceKey, (sourceKeyItem) => {\n          addSource({\n            calcHandler,\n            allSources,\n            sourceKey: sourceKeyItem,\n            sourceObject,\n            eventOptions\n          });\n        });\n      } else {\n        // one key is passed\n        addSource({\n          calcHandler,\n          allSources,\n          sourceKey,\n          sourceObject,\n          eventOptions\n        });\n      }\n    }\n  });\n\n  if (setOnInit) {\n    if (debounceCalcOnInit) {\n      debouncedCalcHandler();\n    } else {\n      syncCalcHandler();\n    }\n  }\n\n  return object;\n}\n"],"file":"index.js"}