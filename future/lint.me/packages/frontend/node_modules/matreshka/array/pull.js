'use strict';

var reportModified = require('./_reportmodified');

var matreshkaError = require('../_helpers/matreshkaerror');

// removes array item by given index
function shift(arr, index) {
    for (var i = index; i < arr.length; i++) {
        arr[i] = arr[i + 1];
    }
    delete arr[arr.length - 1];
    arr.length -= 1;
}

// finds array item that equals to given value and removes it
// returns removed value
function pullByValue(arr, value) {
    for (var i = 0; i < arr.length; i++) {
        if (arr[i] === value) {
            shift(arr, i);
            return value;
        }
    }

    return undefined;
}

// removes array item by given index if the index is not over array length
// returns removed value
function pullByIndex(arr, index) {
    if (index < arr.length) {
        var value = arr[index];
        shift(arr, index);
        return value;
    }

    return undefined;
}

// removes an array item by index (if number is given) or by value (if object is given)
module.exports = pull;
function pull(toRemove) {
    var eventOptions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

    var typeofToRemove = typeof toRemove;
    var removed = void 0;

    if (toRemove && typeofToRemove === 'object') {
        removed = pullByValue(this, toRemove);
    } else if (typeofToRemove === 'number') {
        removed = pullByIndex(this, toRemove);
    } else {
        throw matreshkaError('pull:to_remove_type', { toRemove: toRemove });
    }

    if (typeof removed !== 'undefined') {
        var _keys,
            _l,
            _i,
            _source,
            _key,
            _result = {};

        _result.method = 'pull'
        _result.self = this
        _result.added = []
        _result.removed = [removed]

        for (_source = eventOptions, _keys = Object.keys(_source), _l = _keys.length, _i = 0; _i < _l; _i++) {
            _key = _keys[_i];
            _result[_key] = _source[_key];
        }

        reportModified(this, _result);
    }

    return removed;
}
//# sourceMappingURL=pull.js.map