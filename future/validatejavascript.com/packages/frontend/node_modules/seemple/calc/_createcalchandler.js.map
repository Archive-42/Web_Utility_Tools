{"version":3,"sources":["../../src/calc/_createcalchandler.js"],"names":["createCalcHandler","object","eventOptions","allSources","target","def","handler","calcHandler","changeEvent","values","protector","protectKey","id","promiseCalc","setEventOptions","sourceObject","sourceKey","isDelegated","value","push","targetValue","Promise","resolve","then","promiseResult","e","Error"],"mappings":";;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;;;;;AAEA;AACe,SAASA,iBAAT,OAOZ;AAAA,MANDC,MAMC,QANDA,MAMC;AAAA,MALDC,YAKC,QALDA,YAKC;AAAA,MAJDC,UAIC,QAJDA,UAIC;AAAA,MAHDC,MAGC,QAHDA,MAGC;AAAA,MAFDC,GAEC,QAFDA,GAEC;AAAA,MADDC,OACC,QADDA,OACC;AACD,SAAO,SAASC,WAAT,GAAuC;AAAA,QAAlBC,WAAkB,uEAAJ,EAAI;AAC5C,QAAMC,MAAM,GAAG,EAAf;AAD4C,gCAEjBD,WAFiB,CAEpCE,SAFoC;AAAA,QAEpCA,SAFoC,sCAExB,EAFwB;AAG5C,QAAMC,UAAU,GAAGP,MAAM,GAAGC,GAAG,CAACO,EAAhC;AAH4C,QAIpCC,WAJoC,GAIpBX,YAJoB,CAIpCW,WAJoC;;AAK5C,QAAMC,eAAe;AACnBJ,MAAAA,SAAS,EAATA;AADmB,OAEhBR,YAFgB,MAGhBM,WAHgB,CAArB;;AAMA,QAAIG,UAAU,IAAID,SAAlB,EAA6B;AAC3B;AACD;;AAEDA,IAAAA,SAAS,CAACC,UAAD,CAAT,GAAwB,IAAxB;AAEA,6BAAQR,UAAR,EAAoB,iBAId;AAAA,UAHJY,YAGI,SAHJA,YAGI;AAAA,UAFJC,SAEI,SAFJA,SAEI;AAAA,UADJC,WACI,SADJA,WACI;AACJ,UAAMC,KAAK,GAAGD,WAAW,GAAG,0BAASF,YAAT,EAAuBC,SAAvB,CAAH,GAAuCD,YAAY,CAACC,SAAD,CAA5E;AACAP,MAAAA,MAAM,CAACU,IAAP,CAAYD,KAAZ;AACD,KAPD;AASA,QAAIE,WAAW,GAAG,uBAAMd,OAAN,EAAeL,MAAf,EAAuBQ,MAAvB,CAAlB;;AAEA,QAAII,WAAJ,EAAiB;AACf,UAAI,EAAEO,WAAW,YAAYC,OAAzB,CAAJ,EAAuC;AACrCD,QAAAA,WAAW,GAAGC,OAAO,CAACC,OAAR,CAAgBF,WAAhB,CAAd;AACD;;AAEDA,MAAAA,WAAW,CACRG,IADH,CACQ,UAACC,aAAD;AAAA,eAAmB,qBAAIvB,MAAJ,EAAYG,MAAZ,EAAoBoB,aAApB,EAAmCV,eAAnC,CAAnB;AAAA,OADR,WAES,UAACW,CAAD,EAAO;AACZ,cAAMC,KAAK,CAACD,CAAD,CAAX;AACD,OAJH;AAKD,KAVD,MAUO;AACL,2BAAIxB,MAAJ,EAAYG,MAAZ,EAAoBgB,WAApB,EAAiCN,eAAjC;AACD;AACF,GAzCD;AA0CD","sourcesContent":["import set from '../set';\nimport deepFind from '../_helpers/deepfind';\nimport forEach from '../_helpers/foreach';\nimport apply from '../_helpers/apply';\n\n// creates event handler for target object which will be fired when a source is changed\nexport default function createCalcHandler({\n  object,\n  eventOptions,\n  allSources,\n  target,\n  def,\n  handler\n}) {\n  return function calcHandler(changeEvent = {}) {\n    const values = [];\n    const { protector = {} } = changeEvent;\n    const protectKey = target + def.id;\n    const { promiseCalc } = eventOptions;\n    const setEventOptions = {\n      protector,\n      ...eventOptions,\n      ...changeEvent\n    };\n\n    if (protectKey in protector) {\n      return;\n    }\n\n    protector[protectKey] = true;\n\n    forEach(allSources, ({\n      sourceObject,\n      sourceKey,\n      isDelegated\n    }) => {\n      const value = isDelegated ? deepFind(sourceObject, sourceKey) : sourceObject[sourceKey];\n      values.push(value);\n    });\n\n    let targetValue = apply(handler, object, values);\n\n    if (promiseCalc) {\n      if (!(targetValue instanceof Promise)) {\n        targetValue = Promise.resolve(targetValue);\n      }\n\n      targetValue\n        .then((promiseResult) => set(object, target, promiseResult, setEventOptions))\n        .catch((e) => {\n          throw Error(e);\n        });\n    } else {\n      set(object, target, targetValue, setEventOptions);\n    }\n  };\n}\n"],"file":"_createcalchandler.js"}